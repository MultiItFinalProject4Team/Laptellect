<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.w3.org/1999/xhtml"
      layout:decorate="~{common/layout}">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" th:href="@{/css/product/product.css}">
    <script th:inline="javascript">
    $(document).ready(function() {
        let typeNo = [[${ typeNo }]];

        $('#default-tab').addClass("active");

        function formatPrices() {
            $('.price').each(function() {
                let value = $(this).text().replace(' 원', '').replace(/,/g, '');
                let formattedValue = new Intl.NumberFormat().format(value);
                $(this).text(formattedValue + ' 원');
            });
        }

        function loadInitialProducts() {
            $.ajax({
                url: "/api/product/product-list",
                type: "GET",
                data: { typeNo : typeNo },
                success: function (response) {
                    $('#product-list').html(response);
                    formatPrices();
                },
                error: function (error){
                    console.log(error);
                }
            });
        }

        loadInitialProducts();

        $(".product-link").on("click", function (e) {
           e.preventDefault();
            let typeNo = $(this).data('type-no');
            console.log(typeNo);

              // 모든 탭에서 active 클래스 제거
             $(".product-link").removeClass("active");
              // 클릭된 탭에 active 클래스 추가
             $(this).addClass("active");

            $.ajax({
                url: "/api/product/product-list",
                type: "GET",
                data: { typeNo: typeNo },
                success: function (response) {
                    $('#product-list').html(response);
                    formatPrices();
                },
                error: function (error) {
                    console.log(error);
                }
            });
         });
    });
</script>
</head>

<body>
<div class="container-md" layout:fragment="content">

    <form th:action="@{/product/test}" method="post">
        <select id="productType" name="products">
            <option value="1"> 노트북</option>
            <option value="2"> 마우스</option>
            <option value="3"> 키보드</option>
        </select>
        <button type="submit" class="btn btn-primary mt-3 mb-4">크롤링 시작</button>
    </form>
    <div class="d-flex justify-content-end">
        <div class="input-group">
            <div class="form-outline" data-mdb-input-init>
                <input type="search" id="form1" class="form-control"/>
            </div>
            <button type="button" class="btn btn-primary-input" data-mdb-ripple-init>
                <i class="fas fa-search"></i>
            </button>
        </div>
    </div>
    <div>
        <ul class="nav nav-tab product-taps">
            <li class="nav-item product-item">
                <a class="nav-link product-link" id="default-tab" data-type-no="1" href="#">노트북</a>
            </li>
            <li class="nav-item product-item">
                <a class="nav-link product-link" data-type-no="2" href="#">마우스</a>
            </li>
            <li class="nav-item product-item">
                <a class="nav-link product-link" data-type-no="3" href="#">키보드</a>
            </li>
        </ul>
        <div class="row" id="product-list"></div>
    </div>
</div>

</body>
</html>