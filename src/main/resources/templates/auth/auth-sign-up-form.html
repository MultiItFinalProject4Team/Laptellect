<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.w3.org/1999/xhtml">
<html layout:decorate="~{common/layout}">
<head>
    <title>SingUp Page</title>
<!--    <link rel="stylesheet" th:href="@{/css/signup.css}">-->
<!--    <script type="text/javascript" th:src="@{/js/signup.js}"></script>-->
</head>
<body>

<div layout:fragment="content">

    <div class="container">
        <div class="logo">
            <h1 id="signupTitle">Laptellect</h1>
        </div>
        <form id="signUpForm" method="post" action="/signup" th:object="${member}">
            <div class="form-group" mb-3>
                <label for="member_name"><i class="fa fa-envelope-o" aria-hidden="true"></i> 아이디</label>
                <input type="text" class="form-control" id="member_name" th:field="*{userName}" placeholder="로그인 시 사용할 아이디를 입력해주세요." required>
                <div class="error-message" id="idError" style="color: red;">중복된 아이디 입니다.</div>
                <br>
            </div>
            <div class="form-group">
                <label for="email"><i class="fa fa-envelope-o" aria-hidden="true"></i> 이메일</label>
                <input type="email" class="form-control" id="email" th:field="*{email}" placeholder="로그인 시 사용할 이메일을 입력해주세요." required>
                <div class="error-message" id="emailError" style="color: red;">중복된 이메일 입니다.</div>
                <br>
            </div>
            <div class="form-group">
                <label for="password"><i class="fas fa-lock"></i> 비밀번호</label>
                <input type="password" class="form-control" id="password" placeholder="최소 8개의 숫자와 문자 또는 특수기호를 입력해주세요." pattern="(?=.*[a-zA-Z])(?=.*[0-9])(?=.*[!@#$%^&*(),.?&quot;:{}|&lt;&gt;]).{8,}" title="최소 8개의 숫자와 문자 또는 특수기호를 입력해주세요." required>
                <br>
            </div>
            <div class="form-group">
                <label for="confirmPassword"><i class="fas fa-lock"></i> 비밀번호 확인</label>
                <input type="password" class="form-control" id="confirmPassword" th:field="*{password}" placeholder="일상적인 비밀번호는 사용할 수 없습니다." required>

                <div class="error-message" id="passwordError" style="display: none; color: red;">비밀번호가 일치하지 않습니다.</div>
                <div class="error-message" id="passwordError2" style="display: none; color: red;">비밀번호는 8-15자 사이여야 하며, 알파벳, 숫자, 특수문자를 포함해야 합니다.</div>
                <br>
            </div>
            <button type="submit" class="btn btn-custom w-100" id="sing-up">회원가입</button>
        </form>
    </div>

    <script>
        $(function() {
    $(document).ready(function() {
        error-message
            $('.error-message').hide();
            $('#sing-up').prop('disabled', true);

            // 정규식 변수
            let reg = /^(?=.*[a-zA-Z])(?=.*[!@#$%^*+=-])(?=.*[0-9]).{8,15}$/

            function isEmailAndNameAndPassWord() {
                $('#sing-up').prop('disabled', $('#idError').is(':visible') || $('#emailError').is(':visible') || $('#passwordError').is(':visible') || $('#passwordError2').is(':visible'));
            }

            $('#member_name').on('blur', function() {
                let memberName = $(this).val();
                console.log(memberName);

                if (email.length == 0) {
                    $('#emailError').hide();
                    isEmailAndNameAndPassWord();
                    return;
                }

                $.ajax({
                    url: '/member/isEmail',
                    type: 'POST',
                    data: { email: email },
                    success: function(response) {
                        if (response === true) {
                            console.log("중복된 아이디 입니다");
                            $('#idError').show();
                        } else if (response === false) {
                            console.log("중복되지 않은 아이디 입니다");
                            $('#idError').hide();
                        }
                        isEmailAndNameAndPassWord();
                    },
                    error: function() {
                        console.log('아이디 중복 확인 실패');
                        isEmailAndNameAndPassWord();
                    }
                });
            });

            $('#userName').on('blur', function() {
                let name = $(this).val();
                console.log(name);

                if (name.length == 0) {
                    $('#nameError').hide();
                    isEmailAndNameAndPassWord();
                    return;
                }

                $.ajax({
                    url: '/member/isName',
                    type: 'POST',
                    data: { name: name },
                    success: function(response) {
                        if (response === true) {
                            console.log("중복된 닉네임 입니다");
                            $('#nameError').show();
                        } else if (response === false) {
                            console.log("중복되지 않은 닉네임 입니다");
                            $('#nameError').hide();
                        }
                        isEmailAndNameAndPassWord();
                    },
                    error: function() {
                        console.log('닉네임 중복 확인 실패');
                        isEmailAndNameAndPassWord();
                    }
                });
            });

                // 비밀번호 확인
                $('#password, #confirmPassword').on('blur', function() {
                    let password = $('#password').val();
                    let confirmPassword = $('#confirmPassword').val();

                    if (password !== confirmPassword) {
                        $('#passwordError').show();
                    } else {
                        $('#passwordError').hide();
                    }

                    if (!reg.test(password)) {
                        $('#passwordError2').show();
                    } else {
                        $('#passwordError2').hide();
                    }


                    isEmailAndNameAndPassWord();
                });
            });

        });
    </script>

</div>
</body>
</html>