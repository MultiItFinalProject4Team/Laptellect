<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.multi.laptellect.recommend.txttag.model.dao.ProductTagDAO">
    <select id="getAllProducts" resultType="com.multi.laptellect.recommend.txttag.model.dto.ProductDTO2">
        SELECT DISTINCT
            product_no
        FROM
            vw_product_detail
        WHERE
            type_no = 1
        <if test="gpu != null and gpu.size() > 0">
            <foreach item="item" index="index" collection="gpu" open="AND (" separator=" OR " close=")">
                option_value LIKE CONCAT('%', #{ item }, '%')
            </foreach>
        </if>
        <if test="cpu != null and cpu.size() > 0">
            <foreach item="item" index="index" collection="cpu" open="AND (" separator=" OR " close=")">
                option_value LIKE CONCAT('%', #{ item }, '%')
            </foreach>
        </if>
    </select>
    
    <select id="getAllTags" resultType="com.multi.laptellect.recommend.txttag.model.dto.TaggDTO">
        SELECT DISTINCT
            tag_no
        FROM
            laptop_tag
    </select>

    <insert id="insertProductTag">
        INSERT INTO machine_tagkey (product_no, tag_no) VALUES (#{productNo}, #{tagNo})
    </insert>

</mapper>


<!-- vw_product_detail 테이블에서 product_no를 가져온다.-->
<!-- gpu가 null이 아니고 gpu의 크기가 0보다 크면-->
<!-- gpu의 크기만큼 반복문을 돌면서 option_value LIKE CONCAT('%', #{ item }, '%')를 실행한다. -->